<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>
        <!-- Vista del formulario de repair.order -->
        <record id="custom_view_repair_order_form_inherit_consultas" model="ir.ui.view">
            <field name="name">repair.order.form.inherit.consultas</field>
            <field name="model">repair.order</field>
            <field name="inherit_id" ref="repair.view_repair_order_form"/>
            <field name="arch" type="xml">
                <xpath expr="//header" position="replace">
                    <header>
                        <button name="action_validate" invisible="state != 'draft'" type="object" string="Confirm Repair" class="oe_highlight" data-hotkey="v"/>
                        <button name="action_repair_start" invisible="state != 'confirmed'" type="object" string="Start Repair" class="oe_highlight" data-hotkey="q"/>
                        <button name="action_repair_end" invisible="state != 'under_repair' or not has_uncomplete_moves" type="object" string="End Repair" class="oe_highlight" data-hotkey="x" confirm="For some of the parts, there is a difference between the initial demand and the actual quantity that was used. Are you sure you want to confirm ?"/>
                        <button name="action_repair_end" invisible="state != 'under_repair' or has_uncomplete_moves" type="object" string="End Repair" class="oe_highlight" data-hotkey="x"/>
                        <button name="action_assign" invisible="not reserve_visible" string="Check availability" type="object"/>
                        <button name="action_unreserve" type="object" string="Unreserve" invisible="not unreserve_visible" data-hotkey="w"/>
                        <button name="action_create_sale_order" type="object" string="Create Quotation" invisible="state == 'cancel' or sale_order_id"/>
                        <button name="action_repair_cancel" string="Cancel Repair" type="object" invisible="state in ('done', 'cancel')" data-hotkey="l"/>
                        <button name="action_repair_cancel_draft" invisible="state != 'cancel'" string="Set to Draft" type="object" data-hotkey="z"/>
                        <button name="action_fsm_worksheet" 
                                type="object" 
                                string="Rellenar Hoja de Trabajo" 
                                class="oe_highlight" 
                                invisible="state not in ('confirmed', 'under_repair') or not worksheet_template_id"
                                data-hotkey="f"/>
                        <field name="state" widget="statusbar" statusbar_visible="draft,confirmed,under_repair,done"/>
                    </header>
                </xpath>
                <xpath expr="//sheet/group/group[1]" position="inside">
                   <field name="type"/>
                   <field name="worksheet_template_id" 
                          options="{'no_open': True, 'no_quick_create': True}"
                          context="{'default_res_model': 'repair.order'}"/>
                </xpath>
                <xpath expr="//notebook/page[@name='parts']" position="before">
                    <page string="Consultas" name="consultas">                      
                        <field name="consulta_ids" context="{'default_repair_order_id': id}">
                            <list editable="bottom">
                                <control>
                                    <create string="Añadir consulta"/>
                                </control>
                                <field name="consulta_text" string="Producto a consultar"/>
                                <field name="refer" string="Referencia"/>
                                <field name="product_uom_qty" string="Cantidad"/>
                                <field name="picked" string="Usado"/>
                                <field name="product_id" readonly="1" force_save="1"/>
                                <button string="Crear Producto" type="object" name="action_create_product" 
                                        invisible="product_id != False" class="btn-primary"/>
                                <button string="Añadir a Reparación" type="object" name="action_add_to_repair_lines" 
                                        invisible="product_id == False" class="btn-primary"/>
                            </list>
                        </field>
                        <div class="oe_clear"/>
                    </page>
                </xpath>
            </field>
        </record>         
    </data>
</odoo>
