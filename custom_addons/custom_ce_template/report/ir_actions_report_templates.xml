<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- Plantilla para el informe simple por unidad de producto (un solo PDF con múltiples páginas) -->
    <template id="report_simple_saleorder">
        <t t-call="web.html_container">
            <t t-foreach="docs" t-as="doc">
                <!-- Depuración: Mostrar el contexto completo -->
                <t t-set="debug_context" t-value="'Context: ' + str(doc.env.context)"/>
                <t t-call="web.external_layout">
                    <t t-set="doc" t-value="doc.with_context(lang=doc.partner_id.lang)" />
                    <!-- Obtener unit_lines desde el contexto del objeto doc -->
                    <t t-set="unit_lines" t-value="doc.env.context.get('unit_lines', [])"/>
                    <!-- Depuración: Mostrar unit_lines -->
                    <t t-if="unit_lines">
                        <t t-foreach="unit_lines" t-as="line_data">
                            <div class="page">
                                <h2>
                                    <span t-if="doc.state in ['draft','sent']">Simple Quotation # </span>
                                    <span t-else="">Simple Order # </span>
                                    <span t-out="doc.name or ''"/>
                                    <span> - Unit <t t-out="line_data['index'] or ''"/></span>
                                </h2>
                                <div class="row mb-4">
                                    <div class="col">
                                        <strong>Customer</strong>
                                        <div t-out="doc.partner_id.name or ''"/>
                                    </div>
                                    <div class="col">
                                        <strong>Order Date</strong>
                                        <div t-field="doc.date_order" t-options='{"widget": "date"}'/>
                                    </div>
                                </div>
                                <table class="table table-sm">
                                    <thead>
                                        <tr>
                                            <th>Description</th>
                                            <th class="text-end">Quantity</th>
                                            <th class="text-end">Unit Price</th>
                                            <th class="text-end">Amount</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td><span t-out="line_data['name'] or 'Unnamed Product'"/></td>
                                            <td class="text-end">1</td>
                                            <td class="text-end"><span t-out="line_data['price_unit'] or 0.0"/></td>
                                            <td class="text-end"><span t-out="line_data['price_subtotal'] or 0.0"/></td>
                                        </tr>
                                    </tbody>
                                </table>
                                <div class="text-end">
                                    <strong>Total:</strong>
                                    <span t-out="line_data['price_subtotal'] or 0.0" t-options='{"widget": "monetary", "display_currency": doc.currency_id}'/>
                                </div>
                            </div>
                        </t>
                    </t>
                    <t t-else="">
                        <div class="page">
                            <p>No product units available for this order.</p>
                            <!-- Depuración: Mostrar el contenido de unit_lines y el contexto -->
                            <p>Debug: unit_lines = <t t-out="str(unit_lines)"/></p>
                            <p>Debug: doc.env.context = <t t-out="str(doc.env.context)"/></p>
                        </div>
                    </t>
                </t>
            </t>
        </t>
    </template>
</odoo>