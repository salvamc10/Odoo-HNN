<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- Personalizar el layout externo -->
    <template id="custom_external_layout" inherit_id="web.external_layout_standard">
        <!-- Reemplazar el encabezado -->
        <xpath expr="//div[starts-with(@t-attf-class, 'header o_company_')]" position="replace">
            <div class="header" style="text-align: center; margin-bottom: 20px;">
                <img t-att-src="'/custom_ce_template/static/src/img/bhior.jpg'" style="max-width: 150px; margin: 10px;"/>
                <img t-att-src="'/custom_ce_template/static/src/img/bhior2.jpg'" style="max-width: 150px; margin: 10px;"/>
            </div>
        </xpath>

        <!-- Reemplazar el pie de página -->
        <xpath expr="//div[starts-with(@t-attf-class, 'footer o_company_')]" position="replace">
            <div class="footer" style="font-family: Arial, sans-serif; font-size: 10pt; text-align: center; margin-top: 20px;">
                <p>BHIOR Industries Europe, S.L.U.</p>
                <p>CIF: ESB13652730 - Insc. Reg. Merc. Murcia - Tomo 3631 - Folio 101 - Hoja nº MU-110221 Inscripción 1</p>
                <p>Calle Júpiter, 9, 30620 Fortuna, Murcia, España - Tel: +34 868 994 367</p>
                <p>Web: <a href="https://www.bhior.com">www.bhior.com</a> - Email: comercial@bhior.com</p>
                <p>Página <span t-out="page"/> de <span t-out="topage"/></p>
            </div>
        </xpath>
    </template>

    <!-- Plantilla principal para el informe -->
    <template id="report_simple_saleorder">
        <t t-call="web.html_container">
            <t t-foreach="docs" t-as="doc">
                <!-- Depuración: Mostrar el contexto completo -->
                <t t-set="debug_context" t-value="'Context: ' + str(doc.env.context)"/>
                <t t-call="custom_ce_template.custom_external_layout">
                    <t t-set="doc" t-value="doc.with_context(lang=doc.partner_id.lang)" />
                    <!-- Obtener unit_lines desde el contexto del objeto doc -->
                    <t t-set="unit_lines" t-value="doc.env.context.get('unit_lines', [])"/>
                    <!-- Depuración: Mostrar unit_lines -->
                    <t t-if="unit_lines">
                        <t t-foreach="unit_lines" t-as="line_data">
                            <div class="page" style="font-family: Arial, sans-serif; font-size: 12pt; line-height: 1.5;">
                                <h2 style="text-align: center; font-size: 16pt; margin-bottom: 20px;">DECLARACIÓN DE CONFORMIDAD CE</h2>
                                <p style="margin: 5px 0;"><strong>EL FABRICANTE:</strong> BHIOR Industries Europe, S.L.U</p>
                                <p style="margin: 5px 0;"><strong>Dirección:</strong> Calle Júpiter, 9, 30629 Fortuna, Murcia, España.</p>
                                <p style="margin: 5px 0;"><strong>Teléfono:</strong> +34 868 994 367</p>
                                <p style="margin: 5px 0;"><strong>Email:</strong> info@bhior.com</p>
                                <br/>
                                <p style="margin: 5px 0;"><strong>DECLARA QUE:</strong></p>
                                <p style="margin: 5px 0;"><strong>El producto:</strong> <span t-out="line_data['name'] or 'Unnamed Product'"/></p>
                                <p style="margin: 5px 0;"><strong>Marca:</strong> BHIOR</p>
                                <p style="margin: 5px 0;"><strong>Modelo:</strong> <span t-out="line_data.get('default_code', '')"/></p>
                                <p style="margin: 5px 0;"><strong>N.º Serie / Año de fabricación:</strong> N/A / <t t-out="doc.date_order.strftime('%Y') if doc.date_order else 'N/A'"/></p>
                                <br/>
                                <p style="margin: 5px 0;"><strong>CUMPLE CON LAS SIGUIENTES DISPOSICIONES LEGALES:</strong></p>
                                <ul style="margin: 10px 0; padding-left: 20px;">
                                    <li>Directiva 2006/42/CE del Parlamento Europeo y del Consejo, relativa a las máquinas.</li>
                                    <li>Directiva 2014/30/UE sobre compatibilidad electromagnética.</li>
                                </ul>
                                <br/>
                                <p style="margin: 5px 0;">Fortuna (España), <t t-out="doc.date_order.strftime('%d de %B de %Y') if doc.date_order else 'N/A'"/></p>
                                <br/><br/>
                                <p style="margin: 5px 0;">BHIOR INDUSTRIES EUROPE, S.L.U</p>
                                <p style="font-size: 10pt; margin: 5px 0;">
                                    BHIOR Industries Europe, S.L.U. - CIF: ESB13652730 - Insc. Reg. Merc. Murcia - Tomo 3631 - Folio 101 - Hoja nº MU-110221 Inscripción 1 - Calle Júpiter, 9, 30620 Fortuna – Murcia - Tel: +34 868 994 367 – w: https://www.bhior.com – M: comercial@bhior.com
                                </p>
                            </div>
                        </t>
                    </t>
                    <t t-else="">
                        <div class="page">
                            <p>No product units available for this order.</p>
                            <p>Debug: unit_lines = <t t-out="str(unit_lines)"/></p>
                            <p>Debug: doc.env.context = <t t-out="str(doc.env.context)"/></p>
                        </div>
                    </t>
                </t>
            </t>
        </t>
    </template>
</odoo>